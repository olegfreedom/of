window.vBulletin=window.vBulletin||{};window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=$.merge(window.vBulletin.phrase.precache,["attach_video","close_preview","enter_link_title","enter_photo_gallery_title","enter_poll_question","enter_title","invalid_user_filedata","loading","max_attachments_reached","no_photos_or_albums","no_post_content_to_preview","please_enter_message_x_chars","please_enter_video_url","preview","saving","select_from_photo_album","unexpected_error","write_something_here","write_something_here_optional","x_selected","your_post_is_now_being_reviewed_and_waiting_for_moderators_approval"]);window.vBulletin.options=window.vBulletin.options||{};window.vBulletin.options.precache=window.vBulletin.options.precache||[];window.vBulletin.options.precache=$.merge(window.vBulletin.options.precache,["postminchars","commentminchars"]);window.vBulletin.contentEntryBox=window.vBulletin.contentEntryBox||{};vBulletin.contentEntryBox.handleButtonPreview=function(I){var K=$(this),M=K.closest("form"),G=M.find('input[name="parentid"]').val(),D=M.find('input[name="channelid"]').val(),C=M.data("content-type")||"",B=M.find(".js-editor").attr("id"),F=vBulletin.ckeditor.getEditorContent(B),J=M.find('.tag-editor-wrapper .tag-list input[name="tags"]').val(),E=(C=="text");if(E&&F==""){openAlertDialog({title:vBulletin.phrase.get("preview"),message:vBulletin.phrase.get("no_post_content_to_preview"),iconType:"error"});return }var L=function(O,N){console.warn("Error loading post: {0}".format(O+" "+N));K.prop("disabled",false);window.vBulletin.loadingIndicator.hide();openAlertDialog({title:vBulletin.phrase.get("preview"),message:vBulletin.phrase.get(O),iconType:"error"})};var A={parentid:G,channelid:D,pagedata:pageData,conversationtype:C,posttags:J,rawtext:F,isAjaxTemplateRender:true,isAjaxTemplateRenderWithData:true};if(C=="gallery"){var H=[];$('.js-photo-postdata input[name="filedataid[]"]',M).each(function(){H.push(this.value);A["title_"+this.value]=$('.js-photo-postdata input[name="title_'+this.value+'"]',M).val()||""});A.filedataid=H}if(C=="link"){A.link={};A.link["title"]=$(".js-link-title",M).val();A.link["meta"]=$(".js-link-meta",M).val();A.link["url"]=$(".js-link-url",M).val();A.link["url_image"]=$(".js-link-preview-checkbox",M).is(":checked")?0:$(".js-link-url-image:checked",M).val()}if(C=="poll"){A.poll={options:[],mutliple:($('input[name="multiple"]',M).is(":checked")?1:0)};$(".js-poll-option",M).each(function(){A.poll["options"].push(this.value)})}if(C=="video"){A.video={};A.video["title"]=$(".js-link-title",M).val();A.video["meta"]=$(".js-link-meta",M).val();A.video["url"]=$(".js-link-url",M).val();A.video["items"]=[];$(".js-video-url",M).each(function(){A.video["items"].push(this.value)})}window.vBulletin.loadingIndicator.show();K.prop("disabled",true);$.ajax({type:"POST",url:vBulletin.getAjaxBaseurl()+"/create-content/load-preview",dataType:"json",data:A,success:function(O){K.prop("disabled",false);window.vBulletin.loadingIndicator.hide();if(!O||O.error||!O.template||(E&&!O.parsedText)){L(O&&O.error?O.error:"unknown_error");return }var N=$("<div />").attr("id","preview-overlay").addClass("h-hide").append($("<div />").addClass("dialog-content")).append($("<div />").addClass("b-button-group h-margin-bottom-m h-clearfix")).appendTo("body");$("<ul />").addClass("conversation-list list-container stream-view activity-view h-clearfix b-post--preview").appendTo($(".dialog-content",N));$("<button />").addClass("js-content-entry-preview-submit b-button b-button--primary h-right").text($(".js-content-entry-submit",M).text()).on("click",function(){M.trigger("submit");N.dialog("close")}).appendTo($(".b-button-group",N));$("<button />").addClass("js-content-entry-preview-close b-button h-right").text(vBulletin.phrase.get("close")).on("click",function(){N.dialog("close")}).appendTo($(".b-button-group",N));$(O.template).appendTo($("ul",N));$(".js-post .js-post__content-text",N).html(O.parsedText);$(".dialog-content a",N).addClass("h-disabled").on("click",function(){return false});$(".dialog-content button",N).prop("disabled",true);N.removeClass("h-hide").dialog({title:vBulletin.phrase.get("preview"),autoOpen:true,modal:true,resizable:false,closeOnEscape:true,showCloseButton:false,width:800,minHeight:0,dialogClass:"preview-dialog-container dialog-container dialog-box",open:function(){$(".b-button--primary",N).focus()},close:function(){N.dialog("destroy").remove()}})},error:function(P,O,N){L("error_loading_preview",N)},complete:function(){K.prop("disabled",false);window.vBulletin.loadingIndicator.hide()}})};vBulletin.contentEntryBox.handleButtonDelete=function(C){var E=$(this),G=$(this.form).data("content-type"),F=G,D=E.closest(".js-content-entry"),B=E.closest(".js-post").data("node-id");if(G!="comment"&&G!="media"){if(E.closest('.content-entry-box[data-node-type="visitorMessage"]').length==1){G="visitorMessage"}else{if(E.closest(".js-conversation-starter").length==1){G=E.closest(".conversation-list.blog-list").length==1?"blog":"topic"}else{G="reply"}}}var A=vBulletin.phrase.get("delete_x",vBulletin.phrase.get("posttype_"+G));$deleteDialog=openConfirmDialog({title:A,message:vBulletin.phrase.get("loading")+"...",width:500,dialogClass:"delete-post-dialog dialog-container dialog-box loading",buttonLabel:{yesLabel:A,noLabel:vBulletin.phrase.get("cancel")},onClickYes:function(){var L=D.find("form"),K=vBulletin.triggerHandler.apply(L.get(0),["beforeDelete"]);if(K===false){return }var J=$deleteDialog.find(".delete-posts-form");var I=J.find("input:radio[name=deletetype]:checked").val()||1;var H={hard:(I==2?1:0),reason:J.find(":input[name=deletereason]").val(),nodeids:B};vBulletin.AJAX({url:vBulletin.normalizeAjaxUrl(J.attr("action")),data:H,error_phrase:"error_deleting_posts_x",success:function(M){$(window).off("beforeunload.editPost");$("body").trigger(F+"_editform_onunload",[D]);if(I==2){if(G=="topic"||G=="blog"){location.replace($("#breadcrumbs .crumb a:last").attr("href")||pageData.baseurl)}else{$('.js-post[data-node-id="'+B+'"]').remove()}}else{var N=$(".filter-wrapper",E.closest(".conversation-view, .ui-tabs-panel, .widget-content").find(".conversation-toolbar")).data("object-instance");if(N&&typeof N.applyFilters=="function"){N.forceApplyFilters()}else{if(G=="visitorMessage"){window.history.back()}else{location.reload()}}}L.trigger("afterDelete")}})}});$.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/render/delete_post_form",data:({postType:G,nodeid:B,authorid:E.data("userid")}),type:"POST",dataType:"json",success:function(H){console.log("/ajax/render/delete_post_form");if(H&&!H.errors){$deleteDialog.removeClass("loading").find(".dialog-content .message").html(H).find("[placeholder]").placeholder().end().end().dialog("option","position","center")}else{console.log("/ajax/render/delete_post_form successful, but response was not valid: "+JSON.stringify(H));openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("invalid_server_response_please_try_again"),iconType:"error",onAfterClose:function(){$deleteDialog.dialog("close")}})}},error:function(J,I,H){console.log("/ajax/render/delete_post_form failed, error: "+H);openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_loading_delete_form_x",J.status),iconType:"error",onAfterClose:function(){$deleteDialog.dialog("close")}})}})};vBulletin.contentEntryBox.handleButtonCancel=function(D,B){var I=this,C=I.form,E,F=$(I).closest(".edit-conversation-container");if(!B){E=vBulletin.triggerHandler.apply(C,["beforeCancel"]);if(E===false){return false}}if(F.length==1){if(!B){return vBulletin.contentEntryBox.openConfirmRemoveContentDialog(function(){var J=vBulletin.triggerHandler.apply(C,["beforeCancel"]);if(J!==false){$(I).trigger("click",[true])}},"cancel_edit")}var G=$(C).data("content-type");var H=(G=="comment")?$(I).closest(".js-comment"):$(I).closest(".js-post__content-wrapper");if(H.length==0){H=$(I).closest(".js-post__content-wrapper")}H.removeClass("b-post--edit");H.find(".b-post__content--edit").removeClass("b-post__content--edit");H.find(".b-post__footer--edit").removeClass("b-post__footer--edit");$(window).off("beforeunload.editPost");$("body").trigger(G+"_editform_onunload",[H]);$(C).trigger("afterCancel");F.empty().hide()}else{if($(I).closest(".sb-dialog").length==1){vBulletin.contentEntryBox.resetForm($(C),true,function(){$(I).closest(".sb-dialog").dialog("close")})}else{if($(this.form).data("message-type")=="vm"||$(this.form).data("message-type")=="pm-reply"||$(this.form).data("message-type")=="reply"){vBulletin.contentEntryBox.resetForm($(this.form),true)}else{var A="";if(this.form.ret&&this.form.ret.value){A=this.form.ret.value}else{if($(this.form).data("message-type")=="pm-new"){A=pageData.baseurl+"/privatemessage/index"}else{if($(this.form).data("message-type")=="pm-forward"){A=pageData.baseurl+"/privatemessage/index"}else{if(this.form.parentid&&this.form.parentid.value){A=pageData.baseurl+"/node/"+this.form.parentid.value}else{A=pageData.baseurl}}}}if(!vBulletin.contentEntryBox.isEmpty($(this.form).closest(".js-content-entry"))){vBulletin.contentEntryBox.openConfirmRemoveContentDialog(function(){document.location.href=A})}else{document.location.href=A}}}}$(C).trigger("afterCancel")};vBulletin.contentEntryBox.validateForm=function(){var O=$(this),J,H=(vBulletin.contentEntryBox.MIN_EDITOR_CONTENT_LEN?vBulletin.contentEntryBox.MIN_EDITOR_CONTENT_LEN:window.vBulletin.options.get("postminchars")),M=window.vBulletin.options.get("commentminchars"),C=$(".js-editor",O),D=C.attr("id"),E=$.trim(C.val()),N=(O.closest(".js-comments").length>0)?true:false,K=O.data("content-type"),G=vBulletin.contentEntryBox.ATTACHLIMIT||0,L=$(".b-content-entry-panel__content--"+K,O);if(K=="video"&&L.length==0){L=$(".b-content-entry-panel__content--link",O)}if(K=="comment"||N){if(E.length<M){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("please_enter_message_x_chars",M),iconType:"warning",onAfterClose:function(){setTimeout(function(){C.focus()},10)}});return false}return true}if(vBulletin.ckeditor.editorExists(D)){J=vBulletin.ckeditor.getEditor(D);var F=J.getData();E=$.trim($("<div />").html(F).text())}if($(".js-content-entry-title",O).is(":visible")&&$.trim($(".js-content-entry-title",O).val())==""){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("please_enter_title_of_topic"),iconType:"warning",onAfterClose:function(){setTimeout(function(){$(".js-content-entry-title",O).focus()},10)}});return false}if((K!=="poll"&&K!="gallery"&&K!="link"&&K!="video")&&C.length>0&&E.length<H){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("please_enter_message_x_chars",H),iconType:"warning",onAfterClose:function(){setTimeout(function(){if(J){J.focus()}else{C.focus()}},10)}});return false}if(K=="gallery"){if($(".js-photo-postdata input",L).length==0){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("please_upload_at_least_one_photo"),iconType:"warning"});return false}if(G>0&&$('.js-photo-postdata input[name^="filedataid"]',L).length>G){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("you_may_only_attach_x_files_per_post",G),iconType:"warning"});return false}}if(K=="link"&&!$.trim(L.find(".js-panel-content").html())){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("please_enter_a_valid_url_and_click_attach"),iconType:"warning",onAfterClose:function(){setTimeout(function(){$(".b-link-input__url",L).focus()},10)}});return false}if(K=="video"&&!$.trim(L.find(".js-panel-content").html())){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("please_enter_a_valid_url_and_click_attach"),iconType:"warning",onAfterClose:function(){setTimeout(function(){$(".b-link-input__url",L).focus()},10)}});return false}if(K=="poll"){var A=0,B=2,I;$(".js-poll-option:visible",O).each(function(){if($.trim($(this).val())!=""){A++}else{if(!I){I=$(this)}}if(A>=B){return false}});if(A<B){openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("please_enter_at_least_x_poll_answers",B),iconType:"warning",onAfterClose:function(){setTimeout(function(){I.focus()},10)}});return false}}return true};vBulletin.contentEntryBox.callbackSubmitSuccess=function(F,C,O,P){console.log("vBulletin.contentEntryBox.callbackSubmitSuccess");if((F&&F.error)||$.trim(F)==""){$(".refresh_imagereg a",P).click();if(typeof Recaptcha!=="undefined"){Recaptcha.reload()}var B;if(F&&F.error&&$.isArray(F.error)&&$.isArray(F.error[0])){switch(F.error[0]){case"toomanyimages":B=vBulletin.phrase.get("toomanyimages",F.error[1],F.error[2]);break;default:$.each(F.error,function(Q,R){$.each(R,function(T,S){if(T>0){R[T]=vBulletin.phrase.get(S)}});F.error[Q]=vBulletin.phrase.get(R)});B=F.error.join("<br />")}}else{if(F&&F.error){B=vBulletin.phrase.get(F.error)}else{B=vBulletin.phrase.get("empty_response")}}openAlertDialog({title:vBulletin.phrase.get("edit_conversation"),message:B,iconType:"warning"});return }P.closest(".js-dialog-body").dialog("close");var E=P.data("content-type")||"";var D=P.attr("ck-editorid")||$(".js-editor",P).attr("id");vBulletin.contentEntryBox.resetForm(P);var H=vBulletin.triggerHandler.apply(P.get(0),["afterSave",$(document),F]);if(H===false){return }var K=pageData,M,A=F.nodeId,N,J,I;N=P.closest(".conversation-content-widget");if(N.length==0){N=P.closest("#activities-tab")}J=$(".conversation-list",N);I=$(".list-container",N);if(P.closest(".private-message-widget").length==1){if(P.closest(".private-message-widget").find(".conversation-list").length==1){document.location.reload()}else{location.href=pageData.baseurl+"/privatemessage/index"}return }if(F.retUrl&&I.length==0){location.href=F.retUrl;return }window.vBulletin.loadingIndicator.show();if(J.hasClass("thread-view")){M="thread"}else{if(J.hasClass("full-activity-view")){M="full-activity-stream"}else{if(J.hasClass("activity-view")){M="activity-stream"}else{M="stream"}}}var G,L=$(".js-post:not(.js-comment):last .b-post__count:first",J).text()||"1";G=Number(L.replace("#",""));K["posts-perpage"]=vBulletin.conversation.POSTS_PER_PAGE;if(M=="thread"){K["comments-perpage"]=vBulletin.conversation.COMMENTS_PER_PAGE}$.post(vBulletin.getAjaxBaseurl()+"/create-content/loadnode",{nodeid:A,view:M,index:G,page:K,type:E,isAjaxTemplateRender:true},function(U){P.closest(".content-entry-inline").hide();P.each(function(V,W){$(W).find("textarea").val("")});window.vBulletin.loadingIndicator.hide();if(U.error){if(F.moderateNode){$textarea=P.find(".js-editor");if(vBulletin.ckeditor.editorExists($textarea)){vBulletin.ckeditor.getEditor($textarea).setData("")}else{$textarea.val("")}showStatusMessage(vBulletin.phrase.get("your_post_is_now_being_reviewed_and_waiting_for_moderators_approval"),"moderate")}else{openAlertDialog({title:vBulletin.phrase.get("conversation"),message:vBulletin.phrase.get(U.error),iconType:"error"})}}else{var S=$(U);if(I.length>1){$tab=P.closest(".tab");if($tab.length>0){I=$(".list-container",$tab)}else{I=$(".list-container",$(".tab.media-tab"))}}if(I.hasClass("ajax-order-newest-first")&&$("li.list-item:first",I).length>0){$("li.list-item:first",I).before(S)}else{I.append(S);var T=S.closest(".ui-tabs-panel").find(".conversation-toolbar-wrapper");if(T.hasClass("scrolltofixed-floating")){var Q=T.data("object-instance");if(Q){Q.addLimit(S.outerHeight(true))}}vBulletin.scrollToAnchor("#post"+A)}if(I.children(".list-item").length>0){I.parent().find(".conversation-empty").addClass("h-hide")}$("body").trigger(E+"_savepost_success",[P]);Responsive.ConversationContent.checkForSignature();var R=$(".js-conversation-starter",N).attr("data-node-id");if(R){if(pageData.threadmarking=="0"||pageData.userid=="0"){vBulletin.cookie.setBbarrayCookie("discussion_view",R,Math.round(new Date().getTime()/1000))}else{$.ajax({url:vBulletin.getAjaxBaseurl()+"/ajax/api/node/markRead",data:{nodeid:R},type:"POST",dataType:"json",complete:function(){},success:function(V){if(V&&!V.error){console.log("Topic "+R+" is marked read successfully!")}else{console.log("Topic "+R+" is marked read failed: "+V.error)}},error:function(X,W,V){console.log("Topic "+R+" is marked read failed:"+V)}})}}}},"json").error(function(S,R,Q){console.warn("Error loading post: {0}".format(Q));openAlertDialog({title:vBulletin.phrase.get("conversation"),message:vBulletin.phrase.get("error_loading_post"),iconType:"error"})}).complete(function(){window.vBulletin.loadingIndicator.hide()});vBulletin.hv.reset()};vBulletin.contentEntryBox.initAjaxFormSubmit=function(){var A=$(".js-content-entry");A.each(function(){var B=$(this);if(B.data("initAjaxFormSubmitDone")||B.closest(".edit-conversation-container").length==1){return }var C=$("form",B);C.each(function(F,E){var D=$(E),G=D.data("content-type");D.ajaxForm({dataType:"json",success:vBulletin.contentEntryBox.callbackSubmitSuccess,error:function(N,M,I){console.warn("Error when submitting content: {0}, {1}".format(M,I));if(M=="parsererror"){var L=String(N.responseText).split(/\r?\n/g);var H,K=L[L.length-1];try{H=$.parseJSON(K)}catch(J){}if(H){vBulletin.contentEntryBox.callbackSubmitSuccess(H,"",N,D);return }}openAlertDialog({title:vBulletin.phrase.get("error"),message:vBulletin.phrase.get("error_x_while_saving_content",I),iconType:"error"})},complete:function(){window.vBulletin.loadingIndicator.hide()},beforeSerialize:function(H,I){$blogWidget=H.closest(".blog-channel-content-widget");if($blogWidget.length>0){$inputs=$blogWidget.find(".blog-editor-additional .content-entry-box input");if($inputs.length>0){$inputs.each(function(K,J){$input=$(J);$("<input>").attr({type:"hidden",id:$input.attr("name"),name:$input.attr("name"),value:($input.attr("checked"))?1:0}).appendTo(H)})}}},beforeSubmit:function(L,K,J){var I=vBulletin.contentEntryBox.validateForm.apply(K,[J]);if(I===false){return false}var H=$("button, .b-button",K);K.one("ajaxStart",function(){H.attr("disabled","disabled");K.one("ajaxComplete",function(){H.removeAttr("disabled")})});window.vBulletin.loadingIndicator.show();return true}})});B.data("initAjaxFormSubmitDone",true)})};vBulletin.contentEntryBox.initVideoEditPane=function(){vBulletin.conversation.bindEditFormEventHandlers("video");$(".b-content-entry .b-content-entry-panel__content--video").each(function(){$this=$(this);if($this.data("initVideoEditPaneDone")){return }$("body").trigger("video_editform_onload",[$this]);$this.data("initVideoEditPaneDone",true)})};vBulletin.contentEntryBox.initPhotoGallery=function(){var D=[],C,A;var B=function(F){var E={width:C};E["padding-"+pageData.textDirRight]="10px";F.css(E);photoSelectorDialog.parent().addClass("has-scrollbar").width(A)};$(document).off("click",".js-photo-selector-button").on("click",".js-photo-selector-button",function(){$(document).data("gallery-container",$(this).closest(".b-content-entry-panel__content--gallery"));D=[];$container=$("body");$photoSelectorContainer=$(".js-photo-selector-wrapper .js-photo-selector-container");if($photoSelectorContainer.length==0){$photoSelectorContainer=$(this).closest(".b-content-entry").find(".js-photo-selector-container")}$photoTab=$(".photo-selector-galleries",$photoSelectorContainer);var E=false;$photoTab.tabs({tabTemplate:'<li class="tab-item"><a href="#{href}"><span>#{label}</span></a></li>',panelTemplate:'<div class="tabPanel photo-display h-left"></div>',spinner:"<em>{0}&#8230;</em>".format(vBulletin.phrase.get("loading")),select:function(F,G){if(!E){return false}if(C&&A){B($(G.panel))}E=false},load:function(J,L){var H=$(L.panel);if(C&&A){B(H)}if(!C||!A){var G=vBulletin.getScrollbarWidth();C=H.width()+G+1;A=photoSelectorDialog.dialog("option","width")+G+11;if(L.panel.scrollHeight>H.height()){B(H)}}else{if(L.panel.scrollHeight<=H.height()){var I={width:""};I["padding-"+pageData.textDirRight]="";H.css(I);photoSelectorDialog.parent().removeClass("has-scrollbar").css("width",photoSelectorDialog.dialog("option","width"))}}var K=$(".photo-item-wrapper .photo-item .filedataid",this),F=$(".js-photo-counter",$(this).parent());K.off("click").on("click",function(N){N.stopPropagation();var O=$(this).data("nodeid");if(this.checked){D.push(O);$(this).closest(".photo-item-wrapper").addClass("selected")}else{$(this).closest(".photo-item-wrapper").removeClass("selected");var M=$.inArray(O,D);if(M!=-1){D.splice(M,1)}}F.html(vBulletin.phrase.get("x_selected",D.length));$(".js-photo-selector-continue",photoSelectorDialog).prop("disabled",D.length==0)});$(".photo-item-wrapper",this).off("click").on("click",function(){var M=$(".photo-checkbox .filedataid",this);M.prop("checked",!M.prop("checked")).triggerHandler("click")});if(D.length>0){K.each(function(){if($.inArray($(this).data("nodeid"),D)!=-1){this.checked=true}});$(".js-photo-selector-continue",photoSelectorDialog).prop("disabled",false)}else{K.prop("checked",false);$(".js-photo-selector-continue",photoSelectorDialog).prop("disabled",true)}F.html(vBulletin.phrase.get("x_selected",D.length));E=true;$(".tabPanel:not(:has(.photo-item-wrapper))",this).addClass("ui-tabs-hide")}});photoSelectorDialog=$photoSelectorContainer.dialog({modal:true,width:591,autoOpen:false,showCloseButton:false,closeOnEscape:false,resizable:false,showTitleBar:true,title:vBulletin.phrase.get("select_from_photo_album"),dialogClass:"js-photo-selector-wrapper photo-selector-wrapper dialog-container dialog-box"});$.ajax({url:vBulletin.getAjaxBaseurl()+"/profile/get-photo-tabs",type:"POST",dataType:"json",success:function(F){var H=F.nodes,G=F.error,J;$(".photo-selector-tabs",$photoSelectorContainer).html("");if(G){openAlertDialog({title:vBulletin.phrase.get("select_from_photo_album"),message:vBulletin.phrase.get(G),iconType:"warning"})}else{var I=2;$.each(H,function(K,L){if(L.nodeid!=-1){J=(L.nodeid==-2?0:L.nodeid);$photoTab.tabs("add",vBulletin.getAjaxBaseurl()+"/profile/get-photo-tab-content?nodeid="+J+"&ppr="+I,vBulletin.htmlEntities(L.title))}});if(A){photoSelectorDialog.parent().addClass("has-scrollbar").css("width",A)}photoSelectorDialog.dialog("open")}},error:function(H,G,F){console.warn("Error loading photo albums: "+F);openAlertDialog({title:vBulletin.phrase.get("select_from_photo_album"),message:vBulletin.phrase.get("error_loading_photo_albums_x",H.status),iconType:"error"})}})})};vBulletin.contentEntryBox.resetForm=function(C,B,A){var D=C.closest(".js-content-entry"),E=D.find(".js-editor");if(B&&!vBulletin.contentEntryBox.isEmpty(D)){return vBulletin.contentEntryBox.openConfirmRemoveContentDialog(function(){vBulletin.contentEntryBox.resetForm(C,false,A)})}C.trigger("reset");$(".photo-display-result, .linkcontainer, .js-photo-postdata, .js-attach-postdata",C).html("");$(".edit-photo-link",C).addClass("h-hide");$(".upload-photo-dialog-container .photo-display-container .photo-display").html("");if(C.attr("default-action")){C.attr("action",C.attr("default-action"))}if(vBulletin.upload&&vBulletin.upload.restoreButtonText){vBulletin.upload.restoreButtonText($(".b-button--upload .js-upload-label",C))}D.find(".b-content-entry-panel__content").each(function(F,G){vBulletin.contentEntryBox.resetPanel($(G))});vBulletin.contentEntryBox.afterPanelChange(D);if(E.attr("id")&&vBulletin.ckeditor.editorExists(E.attr("id"))){vBulletin.ckeditor.toggleToolbar(E,false,true)}D.data("prev-selected-panel","");D.find(".b-toolbar__item").removeClass("b-toolbar__item--active");vBulletin.contentEntryBox.changeFormToSelectedContentType(D.find(".b-toolbar"));vBulletin.ckeditor.resetEditor(E);D.find(".js-content-entry-title").val("");if(D.find(".js-button-group").data("hide-buttons-until-click")){D.find(".js-button-group").addClass("h-hide");D.find(".js-human-verification").addClass("h-hide")}if(typeof A=="function"){A.apply(C)}};vBulletin.contentEntryBox.isPanelEmpty=function(B){if(B.hasClass("b-content-entry-panel__content--gallery")){return !$.trim(B.find(".js-panel-content").html())}else{if(B.hasClass("b-content-entry-panel__content--link")||B.hasClass("b-content-entry-panel__content--video")){return !$.trim(B.find(".js-panel-content").html())&&!B.find(".b-link-input__url").val()}else{if(B.hasClass("b-content-entry-panel__content--poll")){var A=false;$(".b-poll-fieldset .b-form-input__input",B).each(function(){if($(this).val()){A=true;return false}});if(!A){$(".b-poll-fieldset .b-form-control__control",B).each(function(){if(this.defaultChecked!=this.checked){A=true;return false}})}return !A}else{if(B.hasClass("b-content-entry-panel__content--attachment")){return !(B.find(".js-attach-list .js-attach-item").length>1)}}}}return true};vBulletin.contentEntryBox.resetPanel=function(C){C.addClass("h-hide");if(C.hasClass("b-content-entry-panel__content--gallery")){C.find(".js-panel-content").empty();C.find(".b-button--upload .js-upload-label").text(vBulletin.phrase.get("upload"));C.find(".b-form-input__file--hidden").prop("disabled",true);C.find(".js-photo-postdata").empty();var A=vBulletin.upload.getUploadedPhotosDlg(false,C);$(".photo-display",A).empty()}else{if(C.hasClass("b-content-entry-panel__content--link")||C.hasClass("b-content-entry-panel__content--video")){C.find(".js-panel-content").empty();C.find(".b-link-input__url").val("").prop("disabled",true).parent().removeClass("h-hide")}else{if(C.hasClass("b-content-entry-panel__content--poll")){var B=C.find(".b-poll-fieldset__poll-answers li");if(B.length>3){B.filter(function(D){return D>=3}).remove()}C.find(".b-poll-fieldset input").each(function(){var D=this;if(D.type=="text"){D.value="";if($(D).hasClass("placeholder")){setTimeout(function(){$(D).focus().blur().prop("disabled",true)},10)}else{D.disabled=true}}else{if(D.type=="checkbox"){D.checked=D.defaultChecked;if($(D).hasClass("js-poll-timeout")){vBulletin.triggerHandler.apply(D,["click"])}}}})}else{if(C.hasClass("b-content-entry-panel__content--attachment")){C.find('.js-attach-list .js-attach-item:not(.h-hide) .js-attach-ctrl[data-action="remove"]').click()}}}}};vBulletin.contentEntryBox.showPanel=function(A){A.removeClass("h-hide");if(A.closest(".edit-conversation-container").length==1){if(A.hasClass("b-content-entry-panel__content--link")||A.hasClass("b-content-entry-panel__content--video")){$(".b-link-input",A).addClass("h-hide")}}};vBulletin.contentEntryBox.enablePanelFields=function(A){if(A.hasClass("b-content-entry-panel__content--gallery")){A.find(".b-form-input__file--hidden").prop("disabled",false)}else{if(A.hasClass("b-content-entry-panel__content--link")||A.hasClass("b-content-entry-panel__content--video")){A.find(".b-link-input__url").prop("disabled",false)}else{if(A.hasClass("b-content-entry-panel__content--poll")){A.find(".b-poll-fieldset .b-form-input__input").prop("disabled",false)}}}};vBulletin.contentEntryBox.changeFormToSelectedContentType=function(C){var B=C.closest("form"),A=C.data("panel");var E=$(".js-content-entry-title",B);var F=$(".js-editor",B);var D=E.filter(".placeholder").focus();if(!B.data("default-action")){B.data("default-action",B.attr("action"))}if(!B.data("default-content-type")&&B.data("content-type")){B.data("default-content-type",B.data("content-type"))}if(!E.data("default-placeholder")){E.data("default-placeholder",E.attr("placeholder"))}if(!F.data("default-placeholder")){F.data("default-placeholder",F.attr("placeholder"))}if(C.hasClass("b-toolbar__item--active")){switch(A){case"b-content-entry-panel__content--gallery":if(B.closest(".edit-conversation-container").length==1){B.attr("action",vBulletin.getAjaxBaseurl()+"/uploader/save-gallery")}else{B.attr("action",vBulletin.getAjaxBaseurl()+"/create-content/gallery")}B.data("content-type","gallery");E.attr("placeholder",vBulletin.phrase.get("enter_photo_gallery_title"));break;case"b-content-entry-panel__content--link":B.attr("action",vBulletin.getAjaxBaseurl()+"/create-content/link");B.data("content-type","link");E.attr("placeholder",vBulletin.phrase.get("enter_link_title"));break;case"b-content-entry-panel__content--video":B.attr("action",vBulletin.getAjaxBaseurl()+"/create-content/video");B.data("content-type","video");E.attr("placeholder",vBulletin.phrase.get("enter_video_title"));break;case"b-content-entry-panel__content--poll":B.attr("action",vBulletin.getAjaxBaseurl()+"/create-content/poll");B.data("content-type","poll");E.attr("placeholder",vBulletin.phrase.get("enter_poll_question"));break}F.attr("placeholder",vBulletin.phrase.get("write_something_here_optional"));$(".b-editor__placeholder",B).text(vBulletin.phrase.get("write_something_here_optional"))}else{if(B.data("default-action")){B.attr("action",B.data("default-action"))}else{B.attr("action",vBulletin.getAjaxBaseurl()+"/create-content/text")}if(B.data("default-content-type")){B.data("content-type",B.data("default-content-type"))}else{B.data("content-type","text")}if(E.data("default-placeholder")){E.attr("placeholder",E.data("default-placeholder"))}else{E.attr("placeholder",vBulletin.phrase.get("enter_title"))}if(F.data("default-placeholder")){F.attr("placeholder",F.data("default-placeholder"));$(".b-editor__placeholder",B).text(F.data("default-placeholder"))}else{F.attr("placeholder",vBulletin.phrase.get("write_something_here"));$(".b-editor__placeholder",B).text(vBulletin.phrase.get("write_something_here"))}}if(D.length){E.blur()}};vBulletin.contentEntryBox.toggleAdvancedEditor=function(A){var B=A.closest(".js-content-entry").find(".js-editor");if(B.attr("id")&&vBulletin.ckeditor.editorExists(B.attr("id"))){vBulletin.ckeditor.toggleToolbar(B)}else{vBulletin.ckeditor.initEditor(B,{showToolbar:true,success:function(D,C){this.focus();var E=B.data("callback");if(typeof E=="function"){E.call(this,B)}}})}};vBulletin.contentEntryBox.normalizeFloatRowHeight=function(G,E){var A=null,C=null,B=0,D=0;var F=function(L,K,J,I,H){if(I){L.find(K).slice(J,I).height(H)}else{L.find(K).slice(J).height(H)}};G.find(E).each(function(H){C=$(this).position().top;if(C!==A){if(D){F(G,E,B,H,D)}B=H;D=0;A=$(this).position().top}var I=$(this).outerHeight(true);D=D>I?D:I});F(G,E,B,0,D)};vBulletin.contentEntryBox.toggleMoreSmilies=function(){var D=$(this),B=D.closest(".js-smilie-container");var C=function(F){$(".js-smilie-category",F).add(".js-toggle-more-smilies",F).add(".js-smilie-category-preview",F).toggleClass("h-hide");F.toggleClass("b-smilie__container--big")};if(!B.data("all-smilies-loaded")){var E=$("<span />").addClass("h-left h-margin-top-xs").text(vBulletin.phrase.get("loading")+"...");D.after(E).addClass("h-hide");var A=function(F){F.find(".js-smilie-category").each(function(){var J=$(this),I=J.find("img"),H=I.length,G=0;I.off("load").on("load",function(K){++G;if(G>=H-1){vBulletin.contentEntryBox.normalizeFloatRowHeight(J,".js-smilie-button")}})})};vBulletin.AJAX({url:vBulletin.getAjaxBaseurl()+"/ajax/render/contententry_panel_smilies",data:{previewOnly:0},success:function(F,G,I){D.removeClass("h-hide");E.remove();var H=$(F).find(".js-smilie-container");B.replaceWith(H);H.data("all-smilies-loaded","1");C(H);A(H)}})}else{C(B)}return false};vBulletin.contentEntryBox.insertSmilie=function(E){var D=function(H){var J=$(this),L=J.attr("src"),K=J.attr("title"),G=J.data("smilieid");var I=H.document.createElement("img",{attributes:{src:L,"data-cke-saved-src":L,title:K,alt:K,smilieid:G}});H.insertElement(I)};var C=$(this),F=C.closest(".js-content-entry").find(".js-editor"),B=C.find("img").get(0),A=F.attr("id");if(C.hasClass("b-smilie__button--disabled")){return false}if(A&&vBulletin.ckeditor.editorExists(A)){D.apply(B,[vBulletin.ckeditor.getEditor(A)])}else{vBulletin.ckeditor.initEditor(F,{showToolbar:true,success:function(H,G){D.apply(B,[this])}})}return false};vBulletin.contentEntryBox.handlePanelCloseButton=function(B){var A=$(this).parent().data("class");if($(this).parent().is(".cke_top")){A="b-content-entry-panel__content--toggle-editor"}$(this).closest(".b-content-entry").find(".b-toolbar__item[data-panel="+A+"]").trigger("click")};vBulletin.contentEntryBox.handleLinkInputKeypress=function(A){if(A.keyCode==13){$(this).next(".js-attach-button").trigger("click");return false}return true};vBulletin.contentEntryBox.afterPanelChange=function(C){var B=C.find(".js-content-entry-panel"),A=B.find(".b-content-entry-panel__content").not(".h-hide");B.toggleClass("h-hide",!A.length);A.removeClass("b-content-entry-panel__content--first").first().addClass("b-content-entry-panel__content--first");B.closest(".js-content-entry").toggleClass("b-content-entry--all-panels-hidden",A.length==0);var D=B.data("callback");if(typeof D=="function"){D.call(B)}};vBulletin.contentEntryBox.openConfirmRemoveContentDialog=function(B,A){openConfirmDialog({title:vBulletin.phrase.get(A||"content_entry"),message:vBulletin.phrase.get("all_changes_made_will_be_lost_would_you_like_to_continue"),iconType:"warning",onClickYes:B});return false};vBulletin.contentEntryBox.isEditorEmpty=function(A){return vBulletin.ckeditor.isEditorEmpty(A.find(".js-editor"))};vBulletin.contentEntryBox.arePanelsEmtpy=function(B){var A=true;B.find(".b-content-entry-panel__content").each(function(C,D){if(!vBulletin.contentEntryBox.isPanelEmpty($(D))){A=false;return false}});return A};vBulletin.contentEntryBox.isEmpty=function(A){var B=A.find(".js-content-entry-title").val();return((typeof B!="string"||B=="")&&vBulletin.contentEntryBox.isEditorEmpty(A)&&vBulletin.contentEntryBox.arePanelsEmtpy(A))};vBulletin.contentEntryBox.handleAttachmentControls=function(I){var J=$(this),K=J.closest(".js-attach-item"),F=J.data("action"),A=K.data("filedataid"),L=K.data("attachnodeid")||0,N=K.data("fileext"),B=K.data("filename"),H=J.closest("form").find(".js-editor");var M=function(O,W,P,R,S){var T="",Q=pageData.baseurl+"/filedata/fetch?filedataid="+O,U=pageData.baseurl+"/filedata/fetch?type=thumb&filedataid="+O;if(W.match(/^(gif|jpg|jpeg|jpe|png|bmp)$/i)){if(S=="insert_sigpic"){T=" [SIGPIC][/SIGPIC] "}else{if(S=="insert_image"){T=" [IMG]{0}[/IMG] ".format(Q)}else{T=" [ATTACH=CONFIG]n{0}[/ATTACH] ".format(O)}}}else{if(S=="insert_sigpic"){T=""}else{T=" [ATTACH]n{0}[/ATTACH] ".format(O)}}var V=R.document.getBody();V.setAttribute("contentEditable",false);V.setAttribute("contentEditable",true);R.insertHtml(T);window.setTimeout(function(){R.focus();R.execCommand("autogrow")},10)};switch(F){case"remove":var G=function(){console.log("removeAttachmentFromPanel attachnodeid: "+L);if(L>0){$("<input />").attr("type","hidden").attr("name","removeattachnodeids[]").val(L).appendTo(K.closest("form"))}K.remove()};if(vBulletin.ckeditor.editorExists(H.attr("id"))){var D=vBulletin.ckeditor.getEditor(H.attr("id")),E=D.getData(),C=pageData.baseurl+"/filedata/fetch?filedataid="+A;E=E.replace("[ATTACH]n{0}[/ATTACH]".format(A),"");E=E.replace("[ATTACH=CONFIG]n{0}[/ATTACH]".format(A),"");E=E.replace("[IMG]{0}[/IMG]".format(C),"");D.setData(E,function(){G()})}else{G()}break;case"insert":case"insert_image":case"insert_sigpic":default:if(!vBulletin.ckeditor.editorExists(H.attr("id"))){vBulletin.ckeditor.initEditor(H,{success:function(){window.setTimeout(function(){M(A,N,B,vBulletin.ckeditor.getEditor(H.attr("id")),F)},0)}})}else{M(A,N,B,vBulletin.ckeditor.getEditor(H.attr("id")),F)}break}return false};vBulletin.contentEntryBox.handleToolbarButtons=function(D,B){var F=$(this),A=F.closest(".js-content-entry"),H=A.find("."+F.data("panel")),E=F.closest(".js-toolbar-primary").length==1,I=A.data("prev-selected-panel")||"";if(E){if(A.data("allow-type-text")=="0"){F.addClass("b-toolbar__item--unselectable");if(F.hasClass("b-toolbar__item--active")){return false}}if(!B){if((I.length&&I.is(":visible")&&!vBulletin.contentEntryBox.isPanelEmpty(I))||(H.is(":visible")&&!vBulletin.contentEntryBox.isPanelEmpty(H))){return vBulletin.contentEntryBox.openConfirmRemoveContentDialog(function(){if(I.length){vBulletin.contentEntryBox.resetPanel(I);I=""}else{vBulletin.contentEntryBox.resetPanel(H)}F.trigger("click",[true])})}}$(".js-toolbar-primary .b-toolbar__item",A).removeClass(function(){if(this==F.get(0)){$(this).toggleClass("b-toolbar__item--active");return""}return"b-toolbar__item--active b-toolbar__item--unselectable"});if(I.length&&I.is(":visible")){vBulletin.contentEntryBox.resetPanel(I);I=""}if(F.hasClass("b-toolbar__item--active")){vBulletin.contentEntryBox.enablePanelFields(H);vBulletin.contentEntryBox.showPanel(H);I=H}else{vBulletin.contentEntryBox.resetPanel(H);I=""}vBulletin.contentEntryBox.changeFormToSelectedContentType(F);A.data("prev-selected-panel",I)}else{if(!B&&F.data("panel")=="b-content-entry-panel__content--attachment"&&H.is(":visible")&&!vBulletin.contentEntryBox.isPanelEmpty(H)){return vBulletin.contentEntryBox.openConfirmRemoveContentDialog(function(){vBulletin.contentEntryBox.resetPanel(H);F.trigger("click",[true])})}F.toggleClass("b-toolbar__item--active");if(F.data("panel")=="b-content-entry-panel__content--toggle-editor"){vBulletin.contentEntryBox.toggleAdvancedEditor(F)}else{H.toggleClass("h-hide",!F.hasClass("b-toolbar__item--active"))}}vBulletin.contentEntryBox.afterPanelChange(A);var G=A.find(".js-human-verification"),C=G.find(".imagereg");A.find(".js-button-group").removeClass("h-hide");G.removeClass("h-hide");if(C.height()!=C.attr("height")){G.find(".refresh_imagereg").click()}};vBulletin.contentEntryBox.init=function(){console.log("vBulletin.contentEntryBox.init start");var A=$(".js-content-entry").not(".js-content-entry-basic");vBulletin.ckeditor.checkEnvironment();if(A.length>0){$("form",A).each(function(){var C=$(this),D=C.find(".js-editor"),B=vBulletin.ckeditor.getEditorContent(D);C.trigger("reset");if(B){if(vBulletin.ckeditor.editorExists(D)){vBulletin.ckeditor.getEditor(D).setData(B)}else{D.val(B)}}});vBulletin.contentEntryBox.initAjaxFormSubmit();vBulletin.contentEntryBox.initPhotoGallery();vBulletin.contentEntryBox.initVideoEditPane();$(document).off("click",".js-content-entry-preview").on("click",".js-content-entry-preview",vBulletin.contentEntryBox.handleButtonPreview);$(document).off("keydown",".js-content-entry .b-link-input__url").on("keydown",".js-content-entry .b-link-input__url",vBulletin.contentEntryBox.handleLinkInputKeypress);$(document).off("focus",".js-content-entry .js-editor").on("focus",".js-content-entry .js-editor",function(){var B=$(this).closest(".js-content-entry"),D=B.find(".js-human-verification"),C=D.find(".imagereg");B.find(".js-button-group").removeClass("h-hide");D.removeClass("h-hide");if(C.height()!=C.attr("height")){D.find(".refresh_imagereg").click()}})}$(document).off("click",".js-content-entry-delete").on("click",".js-content-entry-delete",vBulletin.contentEntryBox.handleButtonDelete);$(document).off("click",".js-content-entry-cancel").on("click",".js-content-entry-cancel",vBulletin.contentEntryBox.handleButtonCancel);$(document).off("click",".b-content-entry .b-toolbar__item").on("click",".b-content-entry .b-toolbar__item",vBulletin.contentEntryBox.handleToolbarButtons);$(document).off("click",".js-content-entry .js-contententry-panel-x").on("click",".js-content-entry .js-contententry-panel-x",vBulletin.contentEntryBox.handlePanelCloseButton);$(document).off("click",".js-smilie-container .js-toggle-more-smilies").on("click",".js-smilie-container .js-toggle-more-smilies",vBulletin.contentEntryBox.toggleMoreSmilies);$(document).off("click",".js-smilie-container .js-smilie-button").on("click",".js-smilie-container .js-smilie-button",vBulletin.contentEntryBox.insertSmilie);$(document).off("click",".js-content-entry .js-attach-ctrl").on("click",".js-content-entry .js-attach-ctrl",vBulletin.contentEntryBox.handleAttachmentControls);A.each(function(){var B=$(this).data("default-content-type");if(B&&B!="Text"){var C=$('.b-toolbar__item[data-panel="b-content-entry-panel__content--{0}"]'.format(B.toLowerCase()),this);if(!C.data("defaultSelected")&&!C.hasClass("b-toolbar__item--active")){C.trigger("click");C.data("defaultSelected",true)}}});console.log("vBulletin.contentEntryBox.init finish")};vBulletin.contentEntryBox.setDefaultTab=function(C){var A=$(C).data("default-content-type");if(A&&A!="Text"){var B=$('.b-toolbar__item[data-panel="b-content-entry-panel__content--{0}"]'.format(A.toLowerCase()),C);if(!B.data("defaultSelected")&&!B.hasClass("b-toolbar__item--active")){B.trigger("click");B.data("defaultSelected",true)}}};vBulletin.contentEntryBox.init();(function(A){A(document).off("click",".additional_options_toggle").on("click",".additional_options_toggle",function(){A(this).siblings(".additional_options_content").toggle()});if(typeof pageData.pageView!="undefined"&&pageData.pageView=="thread"){vBulletin.conversation.replyWithQuotes.showAddWithQuotesButton()}})(jQuery);