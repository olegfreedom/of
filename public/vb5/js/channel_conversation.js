window.vBulletin=window.vBulletin||{};window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=$.merge(window.vBulletin.phrase.precache,[]);window.vBulletin.options=window.vBulletin.options||{};window.vBulletin.options.precache=window.vBulletin.options.precache||[];window.vBulletin.options.precache=$.merge(window.vBulletin.options.precache,[]);(function(A){var B=[".forum-channel-content-widget",".blog-channel-content-widget",".sg-channel-content-widget"];if(!vBulletin.pageHasSelectors(B)){return false}A(document).ready(function(){vBulletin.conversation=vBulletin.conversation||{};var F=A(".channel-content-widget .channel-conversation-list-wrapper");var I=A("#activity-stream-tab",F);var N=A("#recommended-tab",F);var O=A("#subscribed-tab",F);var f=A("#topic-tab",F);var J=A("#media-tab",F);var P=A(".conversation-list",I);var i=A(".conversation-list",N);var a=A(".conversation-list",O);var g=A(".conversation-list",f);var X=A(".conversation-list",F);var L,h,U,b,C;var e,c,V,E;var M,Z,W,Y;var d,G,R=true;var K=F.find(".widget-tabs-nav .ui-tabs-nav > li"),T=K.filter(".ui-tabs-selected"),S=T.index(),k,D=K.parent().data("allow-history")=="1",H=new vBulletin.history.instance(D);if(S==-1){S=0;T=K.first()}k=T.find("> a").attr("href");var Q=function(l){var m=(F.offset().top+(F.outerHeight()-parseFloat(F.css("border-bottom-width")))-l.height());console.log(m);return m};var j=function(l){l=l||k;return K.filter('li:has(a[href*="'+l+'"])').first().index()};K.removeClass("ui-state-disabled");vBulletin.tabify.call(F,{tabHistory:H,getTabIndexByHash:j,allowHistory:D,tabParamAsQueryString:true,hash:F.find(".js-module-top-anchor").attr("id"),tabOptions:{selected:S,select:function(n,o){if(W){W.hideFilterOverlay()}if(U){U.hideFilterOverlay()}if(V){V.hideFilterOverlay()}var m=F.find(".widget-tabs-panel .ui-tabs-panel:visible");var l=m.find(".list-item-body-wrapper.edit-post .edit-conversation-container");if(l.length>0){openAlertDialog({title:vBulletin.phrase.get("edit_conversation"),message:vBulletin.phrase.get("you_have_a_pending_edit_unsaved"),iconType:"warning",onAfterClose:function(){vBulletin.animateScrollTop(l.closest(".list-item").offset().top,{duration:"slow"})}});return false}},show:function(n,p){if(p.tab.hash=="#activity-stream-tab"){if(U){U.toggleNewConversations(false)}if(!W){M=A(".conversation-toolbar-wrapper.scrolltofixed-floating",I);Z=new vBulletin.scrollToFixed({element:M,limit:Q(M)});G=new vBulletin.pagination({context:I,allowHistory:D,onPageChanged:function(q,r){W.updatePageNumber(q);if(!r){W.applyFilters(false,true,false,true)}}});W=new vBulletin.conversation.filter({context:I,autoCheck:A(".toolbar-filter-overlay input[type=radio][value=conversations_on]",I).is(":checked"),scrollToTop:F,pagination:G,allowHistory:D,onContentLoad:function(){Z.updateLimit(Q(M));vBulletin.truncatePostContent(P);vBulletin.conversation.processPostContent(P)}});if(k==p.tab.hash){vBulletin.truncatePostContent(P);vBulletin.conversation.processPostContent(P);W.lastFilters={filters:W.getSelectedFilters(A(".toolbar-filter-overlay",I))}}}else{W.setOption("context",I);G.setOption("context",I);if(typeof W.lastFilters!="undefined"&&A(".conversation-empty:not(.h-hide)",p.panel).length>0){delete W.lastFilters}}W.applyFilters(false,true)}else{if(p.tab.hash=="#subscribed-tab"){if(W){W.toggleNewConversations(false)}if(U){U.toggleNewConversations(false)}if(!V){e=A(".conversation-toolbar-wrapper.scrolltofixed-floating",O);c=new vBulletin.scrollToFixed({element:e,limit:Q(e)});V=new vBulletin.conversation.filter({context:O,scrollToTop:F,allowHistory:D,onContentLoad:function(){c.updateLimit(Q(e));vBulletin.truncatePostContent(a);vBulletin.conversation.processPostContent(a)}});if(k==p.tab.hash){vBulletin.truncatePostContent(a);vBulletin.conversation.processPostContent(a);V.lastFilters={filters:V.getSelectedFilters(A(".toolbar-filter-overlay",O))}}}else{V.setOption("context",O);if(typeof V.lastFilters!="undefined"&&A(".conversation-empty:not(.h-hide)",p.panel).length>0){delete V.lastFilters}}V.applyFilters(false)}else{if(p.tab.hash=="#topic-tab"){if(W){W.toggleNewConversations(false)}if(!U){L=A(".conversation-toolbar-wrapper.scrolltofixed-floating",f);h=new vBulletin.scrollToFixed({element:L,limit:Q(L)});d=new vBulletin.pagination({context:f,allowHistory:D,onPageChanged:function(q,r){U.updatePageNumber(q);if(!r){U.applyFilters(false,true,false,true)}}});U=new vBulletin.conversation.filter({context:f,autoCheck:A(".toolbar-filter-overlay input[type=radio][value=conversations_on]",f).is(":checked"),scrollToTop:F,pagination:d,allowHistory:D,onContentLoad:function(){h.updateLimit(Q(L));vBulletin.markreadcheck()}});if(k==p.tab.hash){U.lastFilters={filters:U.getSelectedFilters(A(".toolbar-filter-overlay",f))}}}else{U.setOption("context",f);d.setOption("context",f);if(typeof U.lastFilters!="undefined"&&A(".conversation-empty:not(.h-hide)",p.panel).length>0){delete U.lastFilters}}U.applyFilters(false,true)}else{if(p.tab.hash=="#media-tab"){if(W){W.toggleNewConversations(false)}if(U){U.toggleNewConversations(false)}if(!b){b=A(".conversation-toolbar-wrapper.scrolltofixed-floating",J);C=new vBulletin.scrollToFixed({element:b,limit:Q(b)});var m=new vBulletin.history.instance(D);if(m.isEnabled()){var o=m.getState();if(!o||A.isEmptyObject(o.data)){var l={from:"filter",page:1,tab:p.tab.hash,filters:vBulletin.getSelectedFilters(A("form.toolbar-filter-overlay",p.panel))};m.setDefaultState(l,document.title,location.href)}m.setStateChange(function(t,u,r){var s=m.getState();if(s.data.from=="filter"){m.log(s.data,s.title,s.url);if(p.tab.hash!=s.data.tab){vBulletin.selectTabByIndex.call(A(p.tab).closest(".ui-tabs-nav"),p.index)}else{var q=A('.media-filter-overlay input[name="filter_time"][value="{0}"]'.format(s.data.filters.filter_time),p.panel).prop("checked",true);if(q.hasClass("js-default-checked")&&q.prop("defaultChecked")){A(".filtered-by .x",p.panel).trigger("click")}else{q.trigger("change",[true])}}}},"filter")}if(k==p.tab.hash){R=false}}else{R=true}if(R&&A("#profileMediaDetailContainer .album-detail",p.panel).length==0){if(!E){E=vBulletin.media.calculatePhotosPerPage(vBulletin.media.TARGET_PHOTOS_PERPAGE)}loadGalleryById({nodeid:-2,channelid:pageData.channelid,pageno:1,dateFilter:A(".filter-options input[name=filter_time]:checked",p.panel).val()||"time_lastweek",perpage:E},true,0,{complete:function(){A(".profile-toolbar .media-toolbar-filter",J).removeClass("h-hide");C.updateLimit(Q(b))}})}}}}}}}});X.off("click",".list-item-poll .view-more-ctrl").on("click",".view-more-ctrl",function(m){var l=A(this).closest("form.poll");var n=l.find("ul.poll");A(this).addClass("h-hide");n.css("max-height","none").find("li.h-hide").slideDown(100,function(){l.find(".action-buttons").removeClass("h-hide").next(".view-less-ctrl").removeClass("h-hide");vBulletin.animateScrollTop(l.offset().top,{duration:"fast"})});return false});X.off("click",".list-item-poll .view-less-ctrl").on("click",".view-less-ctrl",function(m){var l=A(this).closest("form.poll");vBulletin.conversation.limitVisiblePollOptionsInAPost(l,3);l.find("ul.poll").css("max-height","").find("li.h-hide").slideUp(100);return false});X.off("click",".js-post__history").on("click",".js-post__history",vBulletin.conversation.showPostHistory);X.off("click",".js-post-control__ip-address").on("click",".js-post-control__ip-address",vBulletin.conversation.showIp);X.off("click",".js-post-control__edit").on("click",".js-post-control__edit",function(l){vBulletin.conversation.editPost.apply(this,[l,W])});X.off("click",".js-post-control__vote").on("click",".js-post-control__vote",function(l){if(A(l.target).closest(".bubble-flyout").length==1){vBulletin.conversation.showWhoVoted.apply(l.target,[l])}else{vBulletin.conversation.votePost.apply(this,[l])}return false});X.off("click",".js-post-control__flag").on("click",".js-post-control__flag",vBulletin.conversation.flagPost);X.off("click",".js-post-control__comment").on("click",".js-post-control__comment",vBulletin.conversation.toggleCommentBox);X.off("click",".js-comment-entry__post").on("click",".js-comment-entry__post",function(l){vBulletin.conversation.postComment.apply(this,[l,function(){W.updatePageNumber(1).applyFilters(false,true)}])});vBulletin.conversation.bindEditFormEventHandlers("all")})})(jQuery);